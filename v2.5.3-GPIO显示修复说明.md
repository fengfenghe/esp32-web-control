# v2.5.3 GPIO显示修复说明

## 问题描述
页面加载后GPIO列表显示的是默认配置的引脚（2, 13, 14, 15, 16, 17），但ESP32实际返回的是不同的引脚（13, 14, 15, 19, 21, 25），导致：
- GPIO 19、21、25 找不到对应的DOM元素
- 无法显示这些GPIO的实际状态
- 控制台持续报错："✗ 找不到GPIO XX 的状态元素"

## 根本原因
在 `window.addEventListener('load')` 事件中，页面加载时会调用 `renderGPIOList()` 渲染默认GPIO列表。当ESP32返回实际数据时，由于引脚号不匹配，局部更新逻辑无法找到对应的DOM元素。

## 解决方案
**移除页面加载时的初始渲染**，只在收到ESP32实际数据后才渲染GPIO列表：

```javascript
// 修改前（第1833行）
// 初始化GPIO列表（使用默认配置）
renderGPIOList();

// 修改后
// 不在页面加载时渲染GPIO列表，等待从ESP32接收实际数据后再渲染
// renderGPIOList(); // 已注释：避免显示默认GPIO列表导致与实际数据不匹配
```

## 工作流程
1. **页面加载**：GPIO列表区域为空，不显示任何内容
2. **连接设备**：建立MQTT连接
3. **请求数据**：发送 `gpio_get_all` 命令
4. **首次渲染**：收到ESP32响应后，检测到列表为空，执行完整渲染
5. **后续刷新**：检测到列表已有内容，执行局部更新（无页面跳动）

## 首次加载检测逻辑
```javascript
const listEl = document.getElementById('gpioList');
const childCount = listEl.children.length;
const hasGpioCards = listEl.querySelector('.gpio-card') !== null;
const isFirstLoad = childCount === 0 || !hasGpioCards;

if (isFirstLoad) {
    // 首次加载：渲染完整列表
    renderGPIOList(data.data);
} else {
    // 后续刷新：局部更新
    data.data.forEach(gpio => {
        updateGPIOState({ data: gpio });
    });
}
```

## 测试要点
1. ✅ 页面加载后GPIO区域为空
2. ✅ 连接设备后正确显示所有ESP32返回的GPIO
3. ✅ 自动刷新时只更新变化的GPIO状态
4. ✅ 页面无跳动，滚动位置保持不变
5. ✅ 控制台无"找不到GPIO元素"错误

## 修改文件
- `esp32-web-control/index-v2.5.3.html` (第1833行)
- `esp32-web-control/index.html` (第1833行)

## 版本信息
- 修复版本：v2.5.3
- 修复日期：2026-02-26
- 修复内容：GPIO显示不匹配问题
