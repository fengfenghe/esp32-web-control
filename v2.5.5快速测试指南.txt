========================================
Cloudflare Web v2.5.5 快速测试指南
========================================

版本: v2.5.5 (实时同步优化版)
日期: 2026-02-27

========================================
测试前准备
========================================

1. 确保ESP32设备已连接WiFi
2. 确保ESP32已启用MQTT功能
3. 准备好设备ID（12位完整MAC地址）
4. 打开Cloudflare Web页面

========================================
测试1: 刷新按钮功能明确性
========================================

目的：验证刷新按钮的功能说明是否清晰

步骤：
1. 连接ESP32设备
2. 查看GPIO控制标签页
3. 找到右上角的刷新按钮
4. 鼠标悬停在按钮上

预期结果：
✓ 按钮文本显示为"🔄 手动刷新"
✓ 鼠标悬停时显示tooltip："手动刷新GPIO状态和布局"
✓ 按钮功能明确，不会与自动刷新混淆

========================================
测试2: 自动检测GPIO名称变化
========================================

目的：验证名称变化时自动重新分组

步骤：
1. 连接ESP32设备
2. 在Cloudflare Web查看当前GPIO列表
3. 打开ESP32 Web界面（http://ESP32的IP地址）
4. 在ESP32 Web的GPIO配置页面修改GPIO名称
   例如：将GPIO 13和GPIO 14的名称都改为"继电器"
5. 保存配置
6. 返回Cloudflare Web观察

预期结果：
✓ Cloudflare Web自动检测到名称变化
✓ 自动重新渲染GPIO列表
✓ GPIO 13和GPIO 14自动显示为分组的双列排列
✓ 无需手动刷新或重新连接

调试信息：
- 查看调试日志，应该看到：
  "检测到GPIO X 名称变化: "旧名称" → "新名称""
  "检测到GPIO名称变化，执行完整重新渲染以更新分组"

========================================
测试3: 手动刷新功能
========================================

目的：验证手动刷新按钮的功能

步骤：
1. 连接ESP32设备
2. 在ESP32 Web端修改GPIO名称
3. 在Cloudflare Web点击"🔄 手动刷新"按钮
4. 观察GPIO列表变化

预期结果：
✓ GPIO列表完整重新渲染
✓ 分组显示立即更新
✓ 显示最新的GPIO配置

调试信息：
- 查看调试日志，应该看到：
  "手动刷新：将强制完整重新渲染GPIO列表"
  "检测到强制完整渲染标记"
  "判断为: 首次加载/完整渲染"

========================================
测试4: 双列排列实时更新
========================================

目的：验证与ESP32 Web的一致性

步骤：
1. 在ESP32 Web端：
   - 将GPIO 13命名为"灯光"
   - 将GPIO 14命名为"灯光"
   - 将GPIO 15命名为"灯光"
   - 保存配置

2. 在Cloudflare Web观察：
   - 应该自动显示"灯光"分组
   - 分组内显示3个GPIO的双列排列

3. 在ESP32 Web端：
   - 将GPIO 15命名改为"风扇"
   - 保存配置

4. 在Cloudflare Web观察：
   - "灯光"分组应该只剩2个GPIO
   - GPIO 15应该独立显示为"风扇"

预期结果：
✓ 所有变化都实时反映在Cloudflare Web
✓ 无需手动刷新
✓ 与ESP32 Web保持一致

========================================
测试5: 自动刷新配合名称检测
========================================

目的：验证自动刷新时也能检测名称变化

步骤：
1. 连接ESP32设备
2. 启用自动刷新（间隔5秒）
3. 在ESP32 Web端修改GPIO名称
4. 等待自动刷新触发（最多5秒）
5. 观察Cloudflare Web变化

预期结果：
✓ 自动刷新触发时检测到名称变化
✓ 自动重新渲染GPIO列表
✓ 分组显示自动更新

========================================
测试6: 性能测试
========================================

目的：验证名称检测不影响性能

步骤：
1. 连接ESP32设备
2. 启用自动刷新（间隔3秒）
3. 观察页面响应速度
4. 查看调试日志的更新频率

预期结果：
✓ 页面响应流畅
✓ 没有明显延迟
✓ 调试日志正常更新
✓ 不影响GPIO控制操作

========================================
测试7: 边界情况测试
========================================

测试7.1: 所有GPIO同名
步骤：
1. 将所有GPIO名称改为相同（如"测试"）
2. 观察Cloudflare Web显示

预期结果：
✓ 所有GPIO显示在一个分组内
✓ 双列排列显示

测试7.2: 名称频繁变化
步骤：
1. 快速多次修改GPIO名称
2. 观察Cloudflare Web响应

预期结果：
✓ 每次变化都能正确检测
✓ 页面不会卡顿
✓ 最终显示最新配置

测试7.3: 从分组到独立
步骤：
1. 先将多个GPIO设为同名（形成分组）
2. 再将它们改为不同名称
3. 观察分组是否正确解散

预期结果：
✓ 分组正确解散
✓ GPIO恢复独立显示

========================================
问题排查
========================================

问题1: 名称变化未自动检测
可能原因：
- MQTT消息未收到
- 名称格式不匹配

解决方法：
1. 查看调试日志确认是否收到消息
2. 点击"手动刷新"按钮强制更新
3. 检查ESP32端是否正确发送了更新

问题2: 手动刷新无效
可能原因：
- 设备未连接
- MQTT连接断开

解决方法：
1. 检查连接状态
2. 重新连接设备
3. 查看调试日志的错误信息

问题3: 分组显示不正确
可能原因：
- 名称包含特殊字符
- 缓存问题

解决方法：
1. 点击"手动刷新"按钮
2. 清除浏览器缓存
3. 重新连接设备

========================================
功能验收标准
========================================

✓ 刷新按钮文本为"🔄 手动刷新"
✓ 按钮有tooltip提示
✓ 自动检测GPIO名称变化
✓ 名称变化时自动重新分组
✓ 手动刷新功能正常
✓ 与ESP32 Web保持一致
✓ 性能流畅无卡顿
✓ 调试日志信息完整
✓ 边界情况处理正确

========================================
测试完成检查清单
========================================

□ 测试1: 刷新按钮功能明确性 - 通过
□ 测试2: 自动检测GPIO名称变化 - 通过
□ 测试3: 手动刷新功能 - 通过
□ 测试4: 双列排列实时更新 - 通过
□ 测试5: 自动刷新配合名称检测 - 通过
□ 测试6: 性能测试 - 通过
□ 测试7: 边界情况测试 - 通过

全部通过后，v2.5.5版本可以部署到生产环境！

========================================
